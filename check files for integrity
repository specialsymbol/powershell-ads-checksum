$counter = 0
$countc = 0
Get-ChildItem *.* -Recurse | ForEach-Object {
	$counter++
	if (($_ | Get-Item -stream MD5 -ErrorAction SilentlyContinue | Select-Object -expandproperty Stream) -eq "MD5") {
		if(($_ | Get-Content -stream MD5) -ne ($_ | Get-Filehash -a md5).Hash) {
			Write-Output "Difference found in $_"
		} else {
		$countc++
		$csv = $null
		$csv | Add-Member -Name Filename -Value $_.FullName
		$csv | Add-Member -Name CreationTime -Value ($_ | Get-ItemProperty | select -expand CreationTime | select ticks).ticks
		$csv | Add-Member -Name LastWriteTime -Value ($_ | Get-ItemProperty | select -expand LastWriteTime | select ticks).ticks
		$csv | Add-Member -Name FileSize -Value $_.Length
		$csv | Export-Csv -Path .\MD5old.csv -Delimiter ';' -NoTypeInformation -Append
		}
	}
}
write-output "$counter files verified, $countc files ok"
